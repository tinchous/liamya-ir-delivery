generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Categoria {
  id         Int         @id @default(autoincrement())
  nombre     String      @unique
  productos  Producto[]
}


model Producto {
  id            Int        @id @default(autoincrement())
  codigo_barra  String     @unique
  nombre        String
  categoriaId   Int
  categoria     Categoria  @relation(fields: [categoriaId], references: [id])
  subcategoria  String?
  precio        Float
  descripcion   String?
  imagen        String
  oferta        Boolean    @default(false)
  nuevo         Boolean    @default(false)
  mas_vendido   Boolean    @default(false)
  marca         String?
  unidad_medida String?
  stock         Int?
  estado        String?
  pedidos       PedidoProducto[]
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model Usuario {
  id        Int       @id @default(autoincrement())
  nombre    String
  email     String    @unique
  telefono  String?
  direccion String?
  pedidos   Pedido[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Empleado {
  id         Int      @id @default(autoincrement())
  nombre     String
  rol        String
  usuario    String?
  password   String?
  auditorias Auditoria[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

enum MetodoPago {
  EFECTIVO
  TARJETA_DEBITO_POS
}

model Pedido {
  id              Int               @id @default(autoincrement())
  usuarioId       Int
  usuario         Usuario           @relation(fields: [usuarioId], references: [id])
  orden           String            @unique
  subtotal        Float
  delivery        Float
  total           Float
  metodoPago      MetodoPago
  notas           String?
  direccion       String
  barrio          String
  horarioEntrega  String
  estado          String            @default("pendiente")
  fecha           DateTime          @default(now())
  productos       PedidoProducto[]
}


model PedidoProducto {
  id         Int       @id @default(autoincrement())
  pedidoId   Int
  productoId Int
  cantidad   Int
  pedido     Pedido    @relation(fields: [pedidoId], references: [id])
  producto   Producto  @relation(fields: [productoId], references: [id])
}

model Auditoria {
  id          Int      @id @default(autoincrement())
  empleadoId  Int
  empleado    Empleado @relation(fields: [empleadoId], references: [id])
  accion      String
  fecha       DateTime @default(now())
}
